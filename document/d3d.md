## 交换链（Swap Chain）

显卡里维护着一个当前要显示到显示器上的图像的缓冲区，当你需要渲染3D模型的时候，显卡会更新这个缓冲区并且把缓冲区数据发送给显示器，显示器会把缓冲区里的数据从上到下显示出来。

如果显示器的刷新频率比缓冲区的刷新频率低的话就会出现一个问题。大多数的显示器刷新频率是60Hz（60fps）到100Hz。
如果当显示器刷新到一半的时候，此时显卡缓冲区里的数据被修改了，那么显示器显示出来的图片会被分成两部分，上半部分是没刷新之前的显卡缓冲区里的数据，下半部分是刷新之后的显卡缓冲区里的数据，这个效果叫做tearing。

为了解决这个问题，DirectX实现了一种叫交换链（Swap Chain）的特性。

首先，D3D使用两个缓冲区来优化这个问题：
Direct3D会把数据先写入后台缓冲区（BackBuffer），显示器永远显示前台缓冲区里的内容。
当BackBuffer更新完成之后，Direct3D会把后台缓冲区里的数据再拷贝到前台缓冲区。
但是做这些操作还是有可能会出现tearing问题，因为在显示器刷新的同时Direct3D有可能正在更新前台缓冲区，更新前台缓冲区和刷新显示器这两个动作是同时发生的。

为了解决这个问题，DirectX维护两个指针，一个指针指向后台缓冲区，一个指针指向前台缓冲区，在刷新的时候直接交换两个指针的值，而不是更新缓冲区里的数据。
当BackBuffer更新完之后，BackBuffer变为FrontBuffer，类似如下的流程：
Buffer *BackBuffer = 0X1234;
Buffer *FrontBuffer = 0x9876;
FrontBuffer = BackBuffer;


但是这样做还有一个问题：
当BackBuffer更新好之后，如果此时显示器还没有刷新完，那么就得等待显示器刷新完，才能把BackBuffer变为FrontBuffer，等待显示器刷新完会降低程序的性能。
可以通过创建多个BakcBuffer来获得更好的性能，在显示器刷新的同时，程序里去准备后面的BcakBuffer，当显示器刷新完，把列表中的第一个BackBuffer与FrontBuffer进行交换。
该流程如图所示：


这个流程叫做交换链（Swap chain），它是一个缓冲区的链表，当一个缓冲区完全渲染完毕之后，对链表里的缓冲区的位置进行交换操作。

